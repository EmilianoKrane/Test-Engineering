import React, { useState, useEffect, useRef } from "react";
import Header from "../components/Header";
import Footer from "../components/Footer";
import { Link } from 'react-router-dom';

export default function Content() {

  // Estados para los LEDs
  const [stateLED1, setLED1On] = useState("disp");
  const [stateLED2, setLED2On] = useState("disp");
  const [stateLED3, setLED3On] = useState("disp");

  // Estado para el contenido de la caja de texto para ID 
  const [messages, setMessages] = useState<string>("");

  // Referencia al input 
  const inputRef = useRef<HTMLInputElement>(null);

  // Estado para la comunicaci√≥n serie por puerto
  const [port1, setPort1] = useState<SerialPort | null>(null);
  const [port2, setPort2] = useState<SerialPort | null>(null);

  // Estado para el aviso de finalizado
  const [showMessage, setShowMessage] = useState(false);
  const [showMessageError, setShowMessageError] = useState(false);

  useEffect(() => {
  if (stateLED1 == "on" && stateLED2 == "on" && stateLED3 == "on") {
    setShowMessage(true);   // Mostrar el aviso
  }}, [stateLED1, stateLED2, stateLED3]);

  useEffect(() => {
  if (stateLED1 == "off" || stateLED2 == "off" || stateLED3 == "off") {
    setShowMessageError(true);   // Mostrar el aviso de error
  }}, [stateLED1, stateLED2, stateLED3]);


  // Cuando el componente carga, ponemos el foco en el input
  useEffect(() => {
    inputRef.current?.focus();
    }, []);


// Funci√≥n para esperar N milisegundos
const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));

// Funci√≥n para limpiar estados
const resetEstados = () => {
  setLED1On("disp");
  setLED2On("disp");
  setLED3On("disp");
  setMessages("");
};

// Manejar cuando el GM65 ‚Äúescribe‚Äù algo
const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  setMessages(e.target.value); // copiar lo que se escribi√≥ al input
};

// Manejar cuando el GM65 manda "Enter" despu√©s del c√≥digo
const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
if (e.key === "Enter") {
  console.log("C√≥digo le√≠do:", e.currentTarget.value);

    // Mostrar en el input y limpiar valor
    //e.currentTarget.value = "";
    setMessages(e.currentTarget.value);

    // Esperar 3 segundos antes de borrar el input
    setTimeout(() => {
      setMessages(""); 
    }, 30000); // 10000ms = 10 segundos

}
};

const getColor1 = () => {
  switch (stateLED1) {
    case "on":
      return "limegreen"; // Enciende con 1
    case "waiting":
      return "yellow";    // Enciende con 2
    case "off":
      return "#f73d18ff"; // Enciende con 0
    default:
      return "#a193ff77"; 
  }
};

const getColor2 = () => {
  switch (stateLED2) {
    case "on":
      return "limegreen"; // Enciende con 1
    case "waiting":
      return "yellow";    // Enciende con 2
    case "off":
      return "#f73d18ff"; // Enciende con 0
    default:
      return "#a193ff77";    
  }
};

const getColor3 = () => {
  switch (stateLED3) {
    case "on":
      return "limegreen"; // Enciende con 1
    case "waiting":
      return "yellow";    // Enciende con 2
    case "off":
      return "#f73d18ff"; // Enciende con 0
    default:
      return "#a193ff77"; 
  }
};



const connectPULSAR = async () => {
  try {
    // pedir puerto al usuario
    const selectedPort: SerialPort = await (navigator as any).serial.requestPort();
    await selectedPort.open({ baudRate: 115200 }); 

    // guardamos el puerto en el estado
    setPort1(selectedPort);
    console.log("Puerto COM Test conectado ");

    // empezamos a leer de Arduino
    readFromPULSAR(selectedPort);
  } catch (err) {
    console.error("Error al conectar con la placa:", err);
  }
};

const connectCOMLoad = async () => {
  try {
    // pedir puerto al usuario
    const selectedPort: SerialPort = await (navigator as any).serial.requestPort();
    await selectedPort.open({ baudRate: 9600 }); 

    // guardamos el puerto en el estado
    setPort2(selectedPort);
    console.log("Puerto COM CargaV conectado");

    // empezamos a leer de Arduino
    readFromLoad(selectedPort);
  } catch (err) {
    console.error("Error al conectar con la placa:", err);
  }
};


const sendToPulsar = async (char: string) => {
 if (port1 && port1.writable){
    const encoder = new TextEncoder();
    const writer = port1.writable.getWriter();
    await writer.write(encoder.encode(char));
    writer.releaseLock();
    console.log("JSON enviado a PULSAR:", char); // <-- ahora s√≠ imprime el dato enviado
 }
};

const sendToLoad = async (char: string) => {
  if (port2 && port2.writable) {
    const encoder = new TextEncoder();
    const writer = port2.writable.getWriter();
    await writer.write(encoder.encode(char + "\r\n"));  
    writer.releaseLock();
    console.log("‚úÖ JSON enviado:", char);
  }
};

const readFromPULSAR = async (selectedPort: SerialPort) => {
  const decoder = new TextDecoderStream();
  (selectedPort.readable as any).pipeTo(decoder.writable as any);
  const reader = decoder.readable.getReader();

  let buffer = "";

  while (true) {
    const { value, done } = await reader.read();
    if (done) break;

    if (value) {
      buffer += value; // acumulamos en el buffer

      let parts = buffer.split("\n");  // separamos por salto de l√≠nea
      buffer = parts.pop() || "";      // guardamos lo que qued√≥ incompleto
      
      for (const part of parts){

        const trimmed = part.trim();
        if (!trimmed) continue; //evita parsear vac√≠o

        try {
          // Intentamos convertir el buffer en JSON
          const parsed = JSON.parse(trimmed);
          console.log("JSON recibido:", parsed); // Imprimes JSON en crudo

          // Si trae alguna clave "LecturaCorto", la mostramos en la casilla
          // Si trae alguna clave "LecturaPolaridad", la mostramos en la casilla

            if (parsed) {
            // üîî Emitimos evento con el JSON recibido
            window.dispatchEvent(new CustomEvent("jsonReceived", { detail: parsed }));

          //  if (parsed.LecturaCorto) setJSONCorto(parsed.LecturaCorto);
           // if (parsed.LecturaPolaridad) setJSONPolaridad(parsed.LecturaPolaridad);

            if (parsed.Led1) setLED1On(parsed.Led1);
            if (parsed.Led2) setLED2On(parsed.Led2);
            }

          //buffer = ""; // limpiamos buffer tras parseo correcto
        } 
        catch (err) {
          console.error("Error parseando JSON:", err, trimmed);
        }
      }
    }
  }
};

const readFromLoad = async (selectedPort: SerialPort) => {
  const decoder = new TextDecoderStream();
  (selectedPort.readable as any).pipeTo(decoder.writable as any);
  const reader = decoder.readable.getReader();

  let buffer = "";

  while (true) {
    const { value, done } = await reader.read();
    if (done) break;

    if (value) {
      buffer += value; // acumulamos en el buffer

      let parts = buffer.split("\n");  // separamos por salto de l√≠nea
      buffer = parts.pop() || "";      // guardamos lo que qued√≥ incompleto
      
      for (const part of parts){

        const trimmed = part.trim();
        if (!trimmed) continue; //evita parsear vac√≠o

        try {
          const parsed = JSON.parse(trimmed);
          console.log("JSON recibido:", parsed); // Imprimes JSON en crudo
          if (parsed) {
            window.dispatchEvent(new CustomEvent("jsonReceived", { detail: parsed }));
            if (parsed.Led3) setLED3On(parsed.Led3);
          }
        } 
        catch (err) {
          console.error("Error parseando JSON:", err, trimmed);
        }
      }
    }
  }
};




// --- Espera una respuesta JSON con "Result":"OK" ---
const waitForOK = async (): Promise<boolean> => {
  return new Promise((resolve) => {
    const timeout = setTimeout(() => {
      resolve(false); // ‚è±Ô∏è No lleg√≥ OK en 2s
    }, 2000);

    const checkResponse = (event: CustomEvent) => {
      const parsed = event.detail;

      if (parsed.Resultado === "OK") {
        clearTimeout(timeout);
        window.removeEventListener("jsonReceived", checkResponse as any);
        resolve(true); // ‚úÖ OK recibido
      }
    };
    window.addEventListener("jsonReceived", checkResponse as any);
  });
};


// --- Secuencia completa ---
const Arranque = async () => {
if (!port1) {
    alert("Selecciona un puerto COM para el controlador.");
    return;
  }
/*
if (!port2) {
    alert("Selecciona un puerto COM para la carga variable");
    return;
  }
*/

  // Rutina de ejecuci√≥n
  try {

        sendToPulsar(JSON.stringify({ Function: "Enviar ID", ID: messages }) + "\n")  //Enviar a la pulsar ID 

        setLED1On("waiting");       // Espera LED1 Prueba Cortocircuito
        setLED2On("waiting");       // Espera LED2 Prueba Polaridad
        setLED3On("waiting");       // Espera LED3 Carga Variable

        // ===== Rutina de Prueba de Cortocircuito =====
        await runCortocircuitoTest();

        // ===== Rutina de Prueba de Inv Polaridad =====
        await runPolaridadTest();

        // ===== Rutina de Prueba de Carga Variable =====
        await runCargaVariableTest();     

        console.log("‚úÖ Secuencia completada correctamente");

  } catch (err) {
    console.error("‚ùå Error en la secuencia:", err);
  }
};



async function runCortocircuitoTest(){
  try{
    console.log("‚û°Ô∏è Configurando la carga a 3A...");
    await sendToLoad('{"Funcion": "DYN", "Config": {"Resolution": [3, 1, 3, 1], "Range": [50, 30]}, "Start": "CFG_ON"}');
    await delay(1000);

    console.log("‚û°Ô∏è Encendiendo la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
    await delay(1000);
    
    console.log("‚û°Ô∏è Midiendo demanda nominal...");
    await sendToPulsar(JSON.stringify({ Function: "Lectura Nom" }) + "\n");
    const OKDemandaC1 = await waitForOK(); // Confirmaci√≥n de demanda 3A
    if (OKDemandaC1){
      console.log("‚úÖ Demanda Nominal antes de corto OK");
    }
    else{
      console.log("‚ùå Fall√≥ demanda nominal");
      setLED1On("off");       // Error demanda nominal
      await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
      return;
    }

    console.log("‚û°Ô∏è Enviando Cortocircuito...");
    await sendToPulsar(JSON.stringify({ Function: "Cortocircuito" }) + "\n");
    await delay(500);

    console.log("‚û°Ô∏è Midiendo demanda break...");
    await sendToPulsar(JSON.stringify({ Function: "Lectura Break" }) + "\n");
    const OKCorto = await waitForOK(); // Confirmaci√≥n de demanda 0A
    if (OKCorto){
      console.log("‚úÖ Demanda en corto OK");
    }
    else{
      console.log("‚ùå Fall√≥ demanda en corto");
      setLED1On("off");       // Error demanda corto
      await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');       
      return;
    }
    
    // ¬øPor qu√© apago la carga y la vuelvo a prender?
    console.log("‚û°Ô∏è Apagando la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
    await delay(1200);

    console.log("‚û°Ô∏è Encendiendo la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
    await delay(1200);

    console.log("‚û°Ô∏è Midiendo demanda...");
    await sendToPulsar(JSON.stringify({ Function: "Lectura Nom" }) + "\n");
    const OKDemandaC2 = await waitForOK(); // Confirmaci√≥n de demanda 3A
    if (OKDemandaC2){
      console.log("‚úÖ Demanda despu√©s de corto OK");
      setLED1On("on");       // Prueba aprobada
    }
    else{
      console.log("‚ùå Fall√≥ demanda despu√©s de corto");
      setLED1On("off");       // Error demanda nominal
      await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
      return;
    }

    console.log("‚û°Ô∏è Apagando la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');


  }catch(error) {
    console.error("‚ö†Ô∏è Error en rutina Carga Variable:", error);
    setLED1On("off");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
  }
}



async function runPolaridadTest(){
  try{
        // ===== Rutina de Prueba de Polaridad =====
        await delay(1000);
        console.log("‚û°Ô∏è Prueba de Polaridad...");
        console.log("‚û°Ô∏è Configurando la carga a 3A...");
        await sendToLoad('{"Funcion": "DYN", "Config": {"Resolution": [3, 1, 3, 1], "Range": [50, 30]}, "Start": "CFG_ON"}');
        await delay(1000);

        console.log("‚û°Ô∏è Encendiendo la carga...");
        await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
        await delay(1000);
        
        console.log("‚û°Ô∏è Midiendo demanda nominal...");
        await sendToPulsar(JSON.stringify({ Function: "Lectura Nom" }) + "\n");
        const OKDemandaP1 = await waitForOK(); // Confirmaci√≥n de demanda 3A
        if (OKDemandaP1){
          console.log("‚úÖ Demanda Nominal P1 OK");
        }
        else{
          console.log("‚ùå Fall√≥ demanda nominal");
          setLED2On("off");       // Error demanda nominal
          await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');   
          return;
        }

        console.log("‚û°Ô∏è Enviando prueba Inv Polaridad...");
        await sendToPulsar(JSON.stringify({ Function: "Polaridad" }) + "\n");
        await delay(1000);

        console.log("‚û°Ô∏è Midiendo demanda break...");
        await sendToPulsar(JSON.stringify({ Function: "Lectura Break" }) + "\n");
        const OKPolaridad = await waitForOK(); // Confirmaci√≥n de demanda 0A
        if (OKPolaridad){
          console.log("‚úÖ Demanda en inv polaridad OK");
        }
        else{
          console.log("‚ùå Fall√≥ demanda en inv polaridad");
          setLED2On("off");       // Error demanda corto
          await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');         
          return;
        }
        
        console.log("‚û°Ô∏è Apagando la carga...");
        await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
        await delay(2000);

        console.log("‚û°Ô∏è Encendiendo la carga...");
        await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
        await delay(2000);

        console.log("‚û°Ô∏è Midiendo demanda...");
        await sendToPulsar(JSON.stringify({ Function: "Lectura Nom" }) + "\n");
        const OKDemandaP2 = await waitForOK(); // Confirmaci√≥n de demanda 3A
        if (OKDemandaP2){
          console.log("‚úÖ Demanda despu√©s de inv polaridad OK");
          setLED2On("on");       // Prueba aprobada
          console.log("‚û°Ô∏è Apagando la carga...");
          await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');         
        }
        else{
          console.log("‚ùå Fall√≥ demanda despu√©s de inv polaridad");
          setLED2On("off");       // Error demanda nominal
          await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');         
          return;
        }
  }catch(error) {
    console.error("‚ö†Ô∏è Error en rutina Carga Variable:", error);
    setLED2On("off");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
    sendToPulsar(JSON.stringify({ Function: "TestPolaridad", Estado: "FALLA" }) + "\n");
  }
}


// ‚ö° Funci√≥n para ejecutar la rutina de Carga Variable
async function runCargaVariableTest() {
  try {
    // Paso 1: Configurar y medir 3A
    await delay(1000);
    console.log("‚û°Ô∏è Enviando Carga Variable...");
    console.log("‚û°Ô∏è Configurando la carga a 3A...");
    await sendToLoad('{"Funcion": "DYN", "Config": {"Resolution": [3, 1, 3, 1], "Range": [50, 30]}, "Start": "CFG_ON"}');
    await delay(1000);

    console.log("‚û°Ô∏è Encendiendo la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
    await delay(1000);

    console.log("‚û°Ô∏è Midiendo demanda nominal...");
    await sendToPulsar(JSON.stringify({ Function: "Lectura Nom" }) + "\n");
    const OKCV1 = await waitForOK();
    if (!OKCV1) {
      console.log("‚ùå Fall√≥ demanda nominal CV1");
      setLED3On("off");
      await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
      return;
    }
    console.log("‚úÖ Demanda Nominal CV1 OK");

    // Paso 2: Repite para 3.4A
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
    await delay(1200);

    console.log("‚û°Ô∏è Configurando la carga a 3.4A...");
    await sendToLoad('{"Funcion": "DYN", "Config": {"Resolution": [3.4, 1, 3.4, 1], "Range": [50, 30]}, "Start": "CFG_ON"}');
    await delay(1000);

    console.log("‚û°Ô∏è Encendiendo la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
    await delay(1500);

    console.log("‚û°Ô∏è Midiendo demanda nominal...");
    await sendToPulsar(JSON.stringify({ Function: "Lectura Nom" }) + "\n");
    const OKCV2 = await waitForOK();
    if (!OKCV2) {
      console.log("‚ùå Fall√≥ demanda nominal CV2");
      setLED3On("off");
      await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
      return;
    }
    console.log("‚úÖ Demanda Nominal CV2 OK");

    // Paso 3: Repite para 4A
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
    await delay(1200);

    console.log("‚û°Ô∏è Configurando la carga a 4A...");
    await sendToLoad('{"Funcion": "DYN", "Config": {"Resolution": [4, 1, 4, 1], "Range": [50, 30]}, "Start": "CFG_ON"}');
    await delay(1000);

    console.log("‚û°Ô∏è Encendiendo la carga...");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_ON"}');
    await delay(10000); // Tiempo para que caiga la carga 10s

    console.log("‚û°Ô∏è Midiendo demanda nominal...");
    await sendToPulsar(JSON.stringify({ Function: "Lectura Break" }) + "\n");
    const OKCV3 = await waitForOK();
    if (!OKCV3) {
      console.log("‚úÖ Demanda Nominal CV3 OK");
      setLED3On("on");
    }
    else{
      console.log("‚ùå Fall√≥ demanda nominal CV3");
      setLED3On("off");
    }

    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');

  } catch (error) {
    console.error("‚ö†Ô∏è Error en rutina Carga Variable:", error);
    setLED3On("off");
    await sendToLoad('{"Funcion": "Other", "Config": {"Resolution": [], "Range": []}, "Start": "CFG_OFF"}');
    sendToPulsar(JSON.stringify({ Function: "TestCarga", Estado: "FALLA" }) + "\n");
  }
}



  return (

    <main
      style={{
        width: "565px",        // ancho fijo
        margin: "0 auto",      // centra horizontalmente
        flex: 1,
        display: "flex",
        flexDirection: "column",
        gap: "20px",
        padding: "20px",
      }}
    >

    <div style={{ position: "fixed", top: 0, left: 0, width: "100%", height: "60px", zIndex: 100  }}>
      <Header />
    </div>


    {/* Primera Secci√≥n: ID de producto */}
    <div
        style={{
            display: "flex",       // alineaci√≥n en fila
            alignItems: "center",  // centrado vertical
            gap: "10px",           // espacio entre elementos
            marginTop: "190px",
        }}
        >
        <h2 style={{ margin:  0}}>ID del producto</h2>

        <input
            ref={inputRef}
            type= "text"
            value={messages}
            onChange={handleChange}
            onKeyDown={handleKeyDown}
            style={{ width: "150px", height: "25px" }}
        />

        {/*COM para Pulsar Control*/}
        <button
        onClick={connectPULSAR}
        style={{
            padding: "10px",
            width: "100px",
            borderRadius: "5px",
            cursor: "pointer",
            backgroundColor: port1 ? "#4CAF50" : "#e4e4e490", // Verde si conectado
            color: port1 ? "white" : "black",
            fontWeight: port1 ? "bold" : "normal",
        }}
        >
        {port1 ? "COM TEST ‚úÖ" : "Seleccionar COM TEST"}
        </button>

        {/*COM para Pulsar Potencia*/}
        <button
        onClick={connectCOMLoad}
        style={{
            padding: "10px",
            width: "100px",
            borderRadius: "5px",
            cursor: "pointer",
            backgroundColor: port2 ? "#4CAF50" : "#e4e4e490", // Verde si conectado
            color: port2 ? "white" : "black",
            fontWeight: port2 ? "bold" : "normal",
        }}
        >
        {port2 ? "COM CVar ‚úÖ" : "Seleccionar COM CVar"}
        </button>


    </div>

    {/* Segunda Secci√≥n: Tablero de indicadores*/}
    <div
    style={{
        display: "flex",
        flexDirection: "row",   // o "row" si quieres en fila
        justifyContent: "center",  // centra verticalmente
        alignItems: "center",      // centra horizontalmente
        border: "2px solid #333",       // borde oscuro
        borderRadius: "10px",           // esquinas redondeadas
        padding: "40px",                // espacio interno
        backgroundColor: "#f5f5f5",     // color de fondo claro
        boxShadow: "2px 2px 10px rgba(0,0,0,0.2)", // sombra para dar relieve
        width: "490px",                 // ancho fijo opcional
        height: "1px",                 // ancho fijo opcional
    }}
    >

    <h3
     style={{         
        alignItems: "center", 
        marginTop: 20 }}

    >Tablero de indicadores üîé </h3>

    {/* Configuraci√≥n Fila 1 */}
    <div style={{ 
        display: "flex", 
        alignItems: "center", 
        gap: "12px" }}>

    <div
    style={{
        width: "20px",
        height: "20px",
        borderRadius: "50%",
        backgroundColor: "limegreen",
        border: "1px solid #333",
    }}
    ></div>
    <span>Prueba aprobada</span>
    </div>

    {/* Configuraci√≥n Fila 2 */}
    <div style={{ 
        display: "flex", 
        alignItems: "center", 
        gap: "12px" }}>
    <div
    style={{
        width: "20px",
        height: "20px",
        borderRadius: "50%",
        backgroundColor: "red",
        border: "1px solid #333",
    }}
    ></div>
    <span>Prueba fallida</span>
    </div>

    {/* Configuraci√≥n Fila 3 */}
    <div style={{ 
        display: "flex", 
        alignItems: "center", 
        gap: "12px" }}>
    <div
    style={{
        width: "20px",
        height: "20px",
        borderRadius: "50%",
        backgroundColor: "yellow",
        border: "1px solid #333",
    }}
    ></div>
    <span>Espera...</span>
    </div>
    </div> {/*div Final de Secci√≥n */}



    {/* Tercera Secci√≥n: Botones e indicadores LEDS */}
    <div
    style={{
        flex: 1,
        display: "flex", // dividir en columnas
        justifyContent: "center",
        alignItems: "flex-start",
        gap: "10px",
        padding: "5px",
    }}
    >

    {/* Columna izquierda: Botones de Prueba*/}
    <div
        style={{
        flex: 1,
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        gap: "10px",
        }}
    >
    <h3>PRUEBA TEST</h3>

    <h3
    style={{ margin:  2}}
    >Cortocircuito</h3>

    <h3
    style={{ margin:  10}}
    >Polaridad</h3>

    <h3
    style={{ margin:  10}}
    >Carga Variable</h3>

    {/*Bot√≥n de activaci√≥n de Prueba de Cortocircuito
    <button onClick={() => sendToDual("{\"Function\":\"Cortocircuito\"}")}
        style={{
        padding: "10px",
        width: "120px",
        borderRadius: "5px",
        cursor: "pointer",
        backgroundColor: "#e4e4e490",
        }}
        >
    {stateLED1 ? "Cortocircuito" : "Cortocircuito"}
    </button> */}

    {/*Bot√≥n de activaci√≥n de Prueba de Polaridad
    <button onClick={() => sendToDual("{\"Function\":\"Polaridad\"}")}
        style={{
        padding: "10px",
        width: "120px",
        borderRadius: "5px",
        cursor: "pointer",
        backgroundColor: "#e4e4e490",
        }}
        >
    {stateLED2 ? "Polaridad" : "Polaridad"}
    </button>*/}

    </div>

    {/* Columna derecha: LEDs indicadores */}
    <div
        style={{
        flex: 1,
        display: "flex",
        flexDirection: "column",
        justifyContent: "center",
        alignItems: "center",
        gap: "12px",
        padding: "0px",
        }}
    >
    <h3>ESTADO</h3>

    {/* LED Cortocirtuito */}
    <div
    style={{
        width: "30px",
        height: "30px",
        borderRadius: "50%",
        backgroundColor: getColor1(),
        border: "2px solid #333",
        marginBottom: "5px",
        transition: "background-color 0.5s ease" // Transici√≥n
    }}
    ></div>

    {/* LED Polaridad */}
    <div
    style={{
        width: "30px",
        height: "30px",
        borderRadius: "50%",
        backgroundColor: getColor2(),
        border: "2px solid #333",
        marginBottom: "5px",
        transition: "background-color 0.5s ease" // Transici√≥n
    }}
    ></div>

    {/* LED Carga Variable */}
    <div
    style={{
        width: "30px",
        height: "30px",
        borderRadius: "50%",
        backgroundColor: getColor3(),
        border: "2px solid #333",
        marginBottom: "10px",
        transition: "background-color 0.5s ease" // Transici√≥n
    }}
    ></div>
    </div>

    {/* Columna derecha: Botones de control */}
    <div style={{ 
            flex: 1, 
            display: "flex", 
            flexDirection: "column", 
            justifyContent: "center",
            alignItems: "center",
            marginTop: "80px",
            gap: "10px" }}>

    <button onClick={(Arranque)}
    style={{
        padding: "10px",
        width: "100px",
        height: "50px",
        alignContent: "center",
        borderRadius: "5px",
        cursor: "pointer",
        backgroundColor: "#ef7d26c7", 
        border: "1px solid #000000ff",
        }}
    >
    Arranque
    </button>

    <button onClick={(resetEstados)}
    style={{
        padding: "10px",
        width: "100px",
        height: "50px",
        alignContent: "center",
        borderRadius: "5px",
        cursor: "pointer",
        backgroundColor: "#3a7bfcc7", 
        border: "1px solid #000000ff",
        }}
    >
    Reset
    </button>

    </div>
    </div>




    {/* Secci√≥n Bot√≥n Volver al Men√∫*/}
    <div
    style={{
        flex: 1,
        display: "flex", 
        padding: "10px",
        width: "550px",
        height: "50px",
        justifyContent: "center",
        alignContent: "center",
        alignItems: "center",
        marginBottom: "30px",
        //border: "1px solid #000000ff",
    }}
    >
      <div>
        <Link to="/">Volver al men√∫</Link>
      </div>
    </div>




    {/*Cuarta Secci√≥n*/}
    <div
    style={{
        flex: 1,
        display: "flex", // dividir en columnas
        justifyContent: "center",
        alignItems: "flex-start",
        gap: "10px",
        padding: "5px",
    }}
    >
    </div>


    {/* Mensaje de Aprobaci√≥n*/}
    {showMessage && (
    <div
        style={{
        position: "fixed",
        top: 0,
        left: 0,
        width: "100%",
        height: "100%",
        backgroundColor: "rgba(0,0,0,0.6)", // fondo semi-transparente
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        zIndex: 1000,
        }}
    >
        <div
        style={{
            backgroundColor: "white",
            padding: "30px",
            borderRadius: "15px",
            textAlign: "center",
            boxShadow: "0 5px 20px rgba(0,0,0,0.3)",
            animation: "fadeIn 0.5s ease", // animaci√≥n opcional
        }}
        >
        <h2 style={{ color: "green" }}>‚úÖ ¬°El producto cumple las especificaciones! ‚úÖ</h2>
        <button
        onClick={() => {
            setShowMessage(false);   // Cierra el aviso
            setLED1On("disp");        // Apaga LED1 Prueba Cortocircuito
            setLED2On("disp");        // Apaga LED2 Prueba Polaridad
            setLED3On("disp");        // Apaga LED3 Carga Variable
            setMessages("");         // Limpia casillas
          //  setJSONCorto("");        // Limpia JSON
         //   setJSONPolaridad(""); 
        }}
        >
        Cerrar
        </button>
        </div>
    </div>
    )}


    {/* Mensaje de Error*/}
    {showMessageError && (
    <div
        style={{
        position: "fixed",
        top: 0,
        left: 0,
        width: "100%",
        height: "100%",
        backgroundColor: "rgba(0,0,0,0.6)", // fondo semi-transparente
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        zIndex: 1000,
        }}
    >


        <div
        style={{
            backgroundColor: "white",
            padding: "30px",
            borderRadius: "15px",
            textAlign: "center",
            boxShadow: "0 5px 20px rgba(0,0,0,0.3)",
            animation: "fadeIn 0.5s ease", // animaci√≥n opcional
        }}
        >
        <h2 style={{ color: "red" }}>‚ùå ¬°El producto presenta fallas! ‚ùå</h2>
        <button
        onClick={() => {
            setShowMessageError(false);   // Cierra el aviso
            setMessages("");         // Limpia casillas
        }}
        >
        Cerrar
        </button>

        </div>

    </div>
    )}


    <div style={{ position: "fixed", bottom: 0, left: 0, width: "100%", height: "60px", zIndex: 100}}>
      <Footer />
    </div>

    </main>
  );
}
